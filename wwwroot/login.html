<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Login - Internship Application Manager</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link href="styles.css" rel="stylesheet" />
    <script src="theme.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script src="https://sdk.twilio.com/js/client/releases/1.14.0/twilio.min.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      
      body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: 
          linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        background-attachment: fixed;
        height: 100vh;
        overflow: hidden;
        position: relative;
      }
      
      body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: 
          radial-gradient(circle at 20% 20%, rgba(255, 255, 255, 0.15) 0%, transparent 50%),
          radial-gradient(circle at 80% 80%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
          radial-gradient(circle at 40% 60%, rgba(255, 255, 255, 0.08) 0%, transparent 50%),
          radial-gradient(circle at 60% 30%, rgba(255, 255, 255, 0.05) 0%, transparent 50%);
        pointer-events: none;
        z-index: 0;
      }
      
      body::after {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: 
          linear-gradient(45deg, transparent 49%, rgba(255, 255, 255, 0.02) 50%, transparent 51%),
          linear-gradient(-45deg, transparent 49%, rgba(255, 255, 255, 0.02) 50%, transparent 51%);
        background-size: 100px 100px;
        pointer-events: none;
        z-index: 0;
      }
      
      .login-container {
        height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
        position: relative;
        z-index: 1;
      }
      
      /* Animated background elements */
      .login-container::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
        background-size: 50px 50px;
        animation: float 20s ease-in-out infinite;
        z-index: 0;
      }
      
      @keyframes float {
        0%, 100% { transform: translateY(0px) rotate(0deg); }
        50% { transform: translateY(-20px) rotate(180deg); }
      }
      
      .login-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        padding: 50px 40px;
        border-radius: 24px;
        box-shadow: 
          0 25px 50px rgba(0,0,0,0.15),
          0 0 0 1px rgba(255,255,255,0.2);
        width: 100%;
        max-width: 420px;
        text-align: center;
        position: relative;
        z-index: 1;
        animation: slideUp 0.8s ease-out;
        border: 1px solid rgba(255,255,255,0.3);
      }
      
      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(30px) scale(0.95);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }
      
      .login-logo {
        font-size: 32px;
        font-weight: 800;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 12px;
        letter-spacing: -0.5px;
      }
      
      .login-subtitle {
        color: #64748b;
        margin-bottom: 40px;
        font-size: 16px;
        font-weight: 400;
        line-height: 1.5;
      }
      
      .login-form {
        display: flex;
        flex-direction: column;
        gap: 24px;
      }
      
      .login-form input {
        padding: 16px 20px;
        border: 2px solid #e2e8f0;
        border-radius: 16px;
        font-size: 16px;
        font-weight: 500;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        background: rgba(248, 250, 252, 0.8);
        backdrop-filter: blur(10px);
        color: #1e293b;
        position: relative;
      }
      
      .login-form input::placeholder {
        color: #94a3b8;
        font-weight: 400;
      }
      
      .login-form input:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 
          0 0 0 4px rgba(102, 126, 234, 0.1),
          0 4px 12px rgba(102, 126, 234, 0.15);
        background: white;
      }
      
      .login-buttons {
        display: flex;
        gap: 16px;
        margin-top: 32px;
      }
      
      .btn-login {
        flex: 1;
        padding: 16px 24px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 16px;
        font-size: 16px;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
      }
      
      .btn-login::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
        transition: left 0.5s;
      }
      
      .btn-login:hover {
        box-shadow: 0 12px 35px rgba(102, 126, 234, 0.4);
      }
      
      .btn-login:hover::before {
        left: 100%;
      }
      
      .btn-signup {
        flex: 1;
        padding: 16px 24px;
        background: transparent;
        color: #667eea;
        border: 2px solid #667eea;
        border-radius: 16px;
        font-size: 16px;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
      }
      
      .btn-signup::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 0;
        height: 100%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        transition: width 0.3s ease;
        z-index: -1;
      }
      
      .btn-signup:hover {
        color: white;
        border-color: #667eea;
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
      }
      
      .btn-signup:hover::before {
        width: 100%;
      }
      
      .demo-notice {
        background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(147, 51, 234, 0.1) 100%);
        border: 1px solid rgba(59, 130, 246, 0.2);
        border-radius: 16px;
        padding: 20px;
        margin-top: 32px;
        color: #1e40af;
        font-size: 14px;
        font-weight: 500;
        backdrop-filter: blur(10px);
        animation: fadeIn 0.6s ease-out 0.4s both;
      }
      
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      
      /* Signup Modal Styling */
      .signup-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        backdrop-filter: blur(10px);
        animation: fadeInModal 0.3s ease-out;
      }
      
      @keyframes fadeInModal {
        from {
          opacity: 0;
          backdrop-filter: blur(0px);
        }
        to {
          opacity: 1;
          backdrop-filter: blur(10px);
        }
      }
      
      .signup-modal-content {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        padding: 50px 40px;
        border-radius: 24px;
        box-shadow: 
          0 25px 50px rgba(0,0,0,0.2),
          0 0 0 1px rgba(255,255,255,0.2);
        width: 100%;
        max-width: 480px;
        max-height: 90vh;
        overflow-y: auto;
        position: relative;
        animation: slideInModal 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        border: 1px solid rgba(255,255,255,0.3);
      }
      
      @keyframes slideInModal {
        from {
          opacity: 0;
          transform: translateY(-30px) scale(0.9);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }
      
      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateY(-20px) scale(0.95);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }
      
      .signup-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 1px solid #e2e8f0;
      }
      
      .signup-header h2 {
        margin: 0;
        color: #1e293b;
        font-size: 24px;
        font-weight: 700;
      }
      
      .close {
        font-size: 28px;
        font-weight: bold;
        color: #64748b;
        cursor: pointer;
        transition: color 0.2s;
        line-height: 1;
      }
      
      .close:hover {
        color: #ef4444;
      }
      
      .signup-form {
        display: flex;
        flex-direction: column;
        gap: 20px;
      }
      
      .form-group {
        display: flex;
        flex-direction: column;
      }
      
      .signup-form input {
        padding: 16px 20px;
        border: 2px solid #e2e8f0;
        border-radius: 16px;
        font-size: 16px;
        font-weight: 500;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        background: rgba(248, 250, 252, 0.8);
        backdrop-filter: blur(10px);
        color: #1e293b;
        font-family: inherit;
      }
      
      .signup-form input::placeholder {
        color: #94a3b8;
        font-weight: 400;
      }
      
      .signup-form input:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 
          0 0 0 4px rgba(102, 126, 234, 0.1),
          0 4px 12px rgba(102, 126, 234, 0.15);
        background: white;
      }
      
      .btn-signup-submit {
        padding: 16px 24px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 16px;
        font-size: 16px;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        margin-top: 20px;
        position: relative;
        overflow: hidden;
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
      }
      
      .btn-signup-submit::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
        transition: left 0.5s;
      }
      
      .btn-signup-submit:hover {
        box-shadow: 0 12px 35px rgba(102, 126, 234, 0.4);
      }
      
      .btn-signup-submit:hover::before {
        left: 100%;
      }
      
      .signup-footer {
        text-align: center;
        margin-top: 20px;
        padding-top: 20px;
        border-top: 1px solid #e2e8f0;
      }
      
      .signup-footer p {
        margin: 0;
        color: #64748b;
        font-size: 14px;
      }
      
      .signup-footer a {
        color: #3b82f6;
        text-decoration: none;
        font-weight: 600;
        transition: color 0.2s;
      }
      
      .signup-footer a:hover {
        color: #1e40af;
        text-decoration: underline;
      }
      
      /* Password Toggle Styling */
      .password-input-container {
        position: relative;
        display: flex;
        align-items: center;
      }
      
      .password-input-container input {
        width: 100%;
        padding-right: 50px;
      }
      
      .password-toggle {
        position: absolute;
        right: 12px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        cursor: pointer;
        padding: 8px;
        border-radius: 6px;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10;
      }
      
      .password-toggle:hover {
        background: rgba(59, 130, 246, 0.1);
      }
      
      .eye-icon {
        font-size: 16px;
        transition: all 0.2s ease;
        filter: grayscale(100%) brightness(0);
        opacity: 0.7;
      }
      
      .password-toggle.active .eye-icon {
        opacity: 0.9;
      }
      
      .password-toggle {
        opacity: 0;
        transition: opacity 0.2s ease;
      }
      
      .password-toggle.show {
        opacity: 1;
      }
      
      /* Password Error Styling */
      .password-error {
        color: #ef4444;
        font-size: 14px;
        margin-top: 8px;
        display: flex;
        align-items: center;
        gap: 6px;
        animation: slideDown 0.3s ease-out;
      }
      
      @keyframes slideDown {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      
      .signup-form input.error {
        border-color: #ef4444;
        background: #fef2f2;
        box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
      }
      
      .signup-form input.error:focus {
        border-color: #ef4444;
        box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.2);
      }
      
      /* Login and Signup Error Styling */
      .login-error, .signup-error {
        color: #dc2626;
        font-size: 14px;
        font-weight: 600;
        margin-top: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        animation: slideDown 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        text-align: center;
        background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(220, 38, 38, 0.1) 100%);
        padding: 12px 16px;
        border-radius: 12px;
        border: 1px solid rgba(239, 68, 68, 0.2);
        backdrop-filter: blur(10px);
      }
      
      /* Success Message Styling */
      .success-message {
        color: #059669;
        font-size: 14px;
        font-weight: 600;
        margin-top: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        animation: slideDown 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        text-align: center;
        background: linear-gradient(135deg, rgba(5, 150, 105, 0.1) 0%, rgba(16, 185, 129, 0.1) 100%);
        padding: 12px 16px;
        border-radius: 12px;
        border: 1px solid rgba(16, 185, 129, 0.2);
        backdrop-filter: blur(10px);
      }
    </style>
  </head>
  <body>
    <div class="login-container" id="loginModal">
      <div class="login-card">
        <div class="login-logo">Internship Application Manager</div>
        <div class="login-subtitle">Track your internship applications and manage your career journey</div>
        
        <form class="login-form" id="loginForm">
          <input type="email" placeholder="Email Address" required />
          <div class="password-input-container">
            <input type="password" id="loginPassword" placeholder="Password" required oninput="showPasswordToggle(this)" onblur="hidePasswordToggle(this)" />
            <button type="button" class="password-toggle" onclick="togglePassword('loginPassword', this)" style="display: none;">
              <span class="eye-icon">👁</span>
            </button>
          </div>
          
          <div class="login-buttons">
            <button type="submit" class="btn-login">Login</button>
            <button type="button" class="btn-signup" onclick="showSignupForm()">Sign Up</button>
          </div>
          
          <div class="forgot-password-link">
            <a href="#" onclick="showForgotPasswordModal()" style="color: #667eea; text-decoration: none; font-size: 14px; margin-top: 10px; display: inline-block;">Forgot Password?</a>
          </div>
        </form>
        
        <div class="demo-notice">
          <strong>Demo Mode:</strong> Use "demo@example.com" / "demo123" to see sample data, or create your own account.
        </div>
      </div>
    </div>

    <!-- Signup Modal -->
    <div id="signupModal" class="signup-modal" style="display: none;">
      <div class="signup-modal-content">
        <div class="signup-header">
          <h2>Create Your Account</h2>
          <span class="close" onclick="closeSignupModal()">&times;</span>
        </div>
        <form id="signupForm" class="signup-form">
          <div class="form-group">
            <input type="text" placeholder="Full Name" required />
          </div>
          <div class="form-group">
            <input type="email" placeholder="Email Address" required />
          </div>
          <div class="form-group">
            <div class="password-input-container">
              <input type="password" id="signupPassword" placeholder="Password" required oninput="showPasswordToggle(this)" onblur="hidePasswordToggle(this)" />
              <button type="button" class="password-toggle" onclick="togglePassword('signupPassword', this)" style="display: none;">
                <span class="eye-icon">👁</span>
              </button>
            </div>
          </div>
          <div class="form-group">
            <div class="password-input-container">
              <input type="password" id="confirmPassword" placeholder="Confirm Password" required oninput="showPasswordToggle(this)" onblur="hidePasswordToggle(this)" />
              <button type="button" class="password-toggle" onclick="togglePassword('confirmPassword', this)" style="display: none;">
                <span class="eye-icon">👁</span>
              </button>
            </div>
          </div>
          <button type="submit" class="btn-signup-submit">Create Account</button>
        </form>
        <div class="signup-footer">
          <p>Already have an account? <a href="#" onclick="closeSignupModal();">Login here</a></p>
        </div>
      </div>
    </div>

    <!-- Forgot Password Modal -->
    <div id="forgotPasswordModal" class="signup-modal" style="display: none;">
      <div class="signup-modal-content">
        <div class="signup-header">
          <h2>Reset Password</h2>
          <span class="close" onclick="closeForgotPasswordModal()">&times;</span>
        </div>
        <form id="forgotPasswordForm" class="signup-form">
          <div class="form-group">
            <input type="email" id="resetEmail" placeholder="Enter your email address" required />
          </div>
          <button type="submit" class="btn-signup-submit">Send Reset Link</button>
        </form>
        <div id="resetSuccessMessage" class="success-message" style="display: none;">
          <p>✅ Reset link sent to your email!</p>
        </div>
        <div class="signup-footer">
          <p>Remember your password? <a href="#" onclick="closeForgotPasswordModal();">Login here</a></p>
        </div>
      </div>
    </div>

    <script>
      // Initialize EmailJS
      (function() {
        emailjs.init("X80istNGO-VJ1Q9zZ");
      })();
      
      // Initialize demo account on page load
      document.addEventListener('DOMContentLoaded', function() {
        initializeDemoAccount();
      });
      
      function initializeDemoAccount() {
        const users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
        const demoUser = users.find(u => u.email === 'demo@example.com');
        
        if (!demoUser) {
          // Create demo account with sample data
          const demoUser = {
            id: 'demo',
            name: 'Demo User',
            email: 'demo@example.com',
            password: 'demo123',
            createdAt: new Date().toISOString(),
            isDemo: true
          };
          
          users.push(demoUser);
          localStorage.setItem('registeredUsers', JSON.stringify(users));
          
          // Initialize demo data
          initializeDemoData();
        }
      }
      
      function initializeDemoData() {
        // Sample job postings for demo account
        const samplePostings = [
          {
            id: 1,
            title: "🚀 Software Development Intern",
            company: "Microsoft",
            description: "Join our team as a Software Development Intern and work on cutting-edge projects that impact millions of users worldwide.",
            due_date: "2025-10-15",
            status: "applied",
            created_at: new Date().toISOString()
          },
          {
            id: 2,
            title: "📊 Data Analytics Intern",
            company: "Google",
            description: "Gain hands-on experience in data analysis and visualization while working on real business problems.",
            due_date: "2025-10-30",
            status: "phone_screen",
            created_at: new Date().toISOString()
          },
          {
            id: 3,
            title: "🎨 UX/UI Design Intern",
            company: "Apple",
            description: "Create exceptional user experiences while working with a team of talented designers.",
            due_date: "2025-11-05",
            status: "interview",
            created_at: new Date().toISOString()
          },
          {
            id: 4,
            title: "💰 Financial Analyst Intern",
            company: "Goldman Sachs",
            description: "Join our investment banking team and gain exposure to financial modeling, market analysis, and client presentations.",
            due_date: "2025-10-10",
            status: "applied",
            created_at: new Date().toISOString()
          },
          {
            id: 5,
            title: "🛒 Product Management Intern",
            company: "Amazon",
            description: "Work on products used by millions of customers worldwide. Gain experience in product strategy and user research.",
            due_date: "2025-10-25",
            status: "phone_screen",
            created_at: new Date().toISOString()
          }
        ];
        
        // Store demo data with user-specific key
        localStorage.setItem('demo_user_postings', JSON.stringify(samplePostings));
      }
      
      // Handle login form submission
      document.getElementById('loginForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const email = document.querySelector('#loginForm input[type="email"]').value;
        const password = document.getElementById('loginPassword').value;
        
        // Check if user exists in localStorage
        const users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
        const userByEmail = users.find(u => u.email === email);
        
        if (!userByEmail) {
          // Email doesn't exist
          showLoginError('Email does not exist in our system');
        } else if (userByEmail.password !== password) {
          // Email exists but wrong password
          showLoginError('Incorrect password');
        } else {
          // Valid credentials
          clearLoginError();
          localStorage.setItem('userLoggedIn', 'true');
          localStorage.setItem('currentUser', JSON.stringify(userByEmail));
          window.location.href = 'application-hub.html';
        }
      });
      
      function showSignupForm() {
        document.getElementById('signupModal').style.display = 'flex';
      }
      
      function closeSignupModal() {
        document.getElementById('signupModal').style.display = 'none';
      }
      
      // Handle signup form submission
      document.getElementById('signupForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const fullName = document.querySelector('#signupForm input[type="text"]').value;
        const email = document.querySelector('#signupForm input[type="email"]').value;
        const password = document.getElementById('signupPassword').value;
        const confirmPassword = document.getElementById('confirmPassword').value;
        
        if (password !== confirmPassword) {
          showPasswordMismatchError();
          return;
        }
        
        // Check if user already exists
        const users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
        const existingUser = users.find(u => u.email === email);
        
        if (existingUser) {
          showSignupError('An account with this email already exists!');
          return;
        }
        
        // Clear any existing errors
        clearPasswordMismatchError();
        clearSignupError();
        
        // Create new user
        const newUser = {
          id: Date.now(),
          name: fullName,
          email: email,
          password: password,
          createdAt: new Date().toISOString()
        };
        
        // Add user to database
        users.push(newUser);
        localStorage.setItem('registeredUsers', JSON.stringify(users));
        
        // Show success message
        showSuccessMessage('Account created successfully! You can now login.');
        closeSignupModal();
      });
      
      // Show password toggle when typing
      function showPasswordToggle(input) {
        const container = input.parentElement;
        const toggle = container.querySelector('.password-toggle');
        if (input.value.length > 0) {
          toggle.style.display = 'flex';
          setTimeout(() => toggle.classList.add('show'), 10);
        }
      }
      
      // Hide password toggle when not typing
      function hidePasswordToggle(input) {
        const container = input.parentElement;
        const toggle = container.querySelector('.password-toggle');
        if (input.value.length === 0) {
          toggle.classList.remove('show');
          setTimeout(() => toggle.style.display = 'none', 200);
        }
      }
      
      // Password toggle function
      function togglePassword(inputId, button) {
        const input = document.getElementById(inputId);
        const eyeIcon = button.querySelector('.eye-icon');
        
        if (input.type === 'password') {
          input.type = 'text';
          eyeIcon.textContent = '🙈';
          button.classList.add('active');
        } else {
          input.type = 'password';
          eyeIcon.textContent = '👁';
          button.classList.remove('active');
        }
      }
      
      // Show password mismatch error
      function showPasswordMismatchError() {
        const confirmPasswordContainer = document.getElementById('confirmPassword').parentElement;
        let errorDiv = confirmPasswordContainer.querySelector('.password-error');
        
        if (!errorDiv) {
          errorDiv = document.createElement('div');
          errorDiv.className = 'password-error';
          errorDiv.innerHTML = '❌ Passwords do not match';
          confirmPasswordContainer.appendChild(errorDiv);
        }
        
        // Add error styling to both password fields
        document.getElementById('signupPassword').classList.add('error');
        document.getElementById('confirmPassword').classList.add('error');
      }
      
      // Clear password mismatch error
      function clearPasswordMismatchError() {
        const errorDivs = document.querySelectorAll('.password-error');
        errorDivs.forEach(div => div.remove());
        
        // Remove error styling
        document.getElementById('signupPassword').classList.remove('error');
        document.getElementById('confirmPassword').classList.remove('error');
      }
      
      
      // Show login error
      function showLoginError(message = 'Invalid email or password') {
        const loginForm = document.getElementById('loginForm');
        let errorDiv = loginForm.querySelector('.login-error');
        
        if (!errorDiv) {
          errorDiv = document.createElement('div');
          errorDiv.className = 'login-error';
          loginForm.appendChild(errorDiv);
        }
        
        errorDiv.innerHTML = '❌ ' + message;
      }
      
      // Clear login error
      function clearLoginError() {
        const errorDiv = document.querySelector('.login-error');
        if (errorDiv) {
          errorDiv.remove();
        }
      }
      
      // Show signup error
      function showSignupError(message) {
        const signupForm = document.getElementById('signupForm');
        let errorDiv = signupForm.querySelector('.signup-error');
        
        if (!errorDiv) {
          errorDiv = document.createElement('div');
          errorDiv.className = 'signup-error';
          signupForm.appendChild(errorDiv);
        }
        
        errorDiv.innerHTML = '❌ ' + message;
      }
      
      // Clear signup error
      function clearSignupError() {
        const errorDiv = document.querySelector('.signup-error');
        if (errorDiv) {
          errorDiv.remove();
        }
      }
      
      // Show success message
      function showSuccessMessage(message) {
        // Remove any existing success messages
        const existingSuccess = document.querySelector('.success-message');
        if (existingSuccess) {
          existingSuccess.remove();
        }
        
        // Create success message
        const successDiv = document.createElement('div');
        successDiv.className = 'success-message';
        successDiv.innerHTML = '✅ ' + message;
        
        // Add to login form
        const loginForm = document.getElementById('loginForm');
        loginForm.appendChild(successDiv);
        
        // Auto-remove after 5 seconds
        setTimeout(() => {
          if (successDiv.parentNode) {
            successDiv.remove();
          }
        }, 5000);
      }
      
      // Close modal when clicking outside
      window.onclick = function(event) {
        const signupModal = document.getElementById('signupModal');
        if (event.target === signupModal) {
          closeSignupModal();
        }
      }
      
      // Email functionality
      function sendEmailReminder(posting) {
        const subject = `Reminder: ${posting.title} - Due ${posting.due_date}`;
        const body = `Don't forget about your application for ${posting.title} at ${posting.company}. Due date: ${posting.due_date}`;
        
        // Open default email client
        window.location.href = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
      }
      
      function sendEmailJSReminder(posting) {
        const templateParams = {
          to_email: 'user@example.com',
          subject: `Reminder: ${posting.title}`,
          message: `Don't forget about your application for ${posting.title} at ${posting.company}. Due date: ${posting.due_date}`
        };
        
        emailjs.send('service_lk4nt0v', 'template_a3kh9cp', templateParams)
          .then(response => {
            console.log('Email sent!', response);
            alert('Reminder email sent successfully!');
          })
          .catch(error => {
            console.log('Error:', error);
            alert('Failed to send email. Please try again.');
          });
      }
      
      function sendSMSReminder(posting) {
        const message = `Reminder: ${posting.title} due ${posting.due_date}`;
        const phoneNumber = prompt('Enter your phone number (e.g., +1234567890):');
        
        if (phoneNumber) {
          // Send SMS via email-to-SMS
          const smsEmail = `${phoneNumber}@txt.att.net`; // AT&T example
          const subject = 'Application Reminder';
          
          window.location.href = `mailto:${smsEmail}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(message)}`;
        }
      }
      
      function sendTwilioSMS(posting) {
        const message = `Reminder: ${posting.title} due ${posting.due_date}`;
        const phoneNumber = prompt('Enter your phone number (e.g., +1234567890):');
        
        if (phoneNumber) {
          // Send SMS via Twilio API
          fetch('/api/send-sms', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              to: phoneNumber,
              message: message
            })
          })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              alert('SMS sent successfully!');
            } else {
              alert('Failed to send SMS: ' + data.error);
            }
          })
          .catch(error => {
            console.error('Error:', error);
            alert('Failed to send SMS. Please try again.');
          });
        }
      }
      
      // Forgot Password Functions
      function showForgotPasswordModal() {
        console.log('Opening forgot password modal');
        const forgotModal = document.getElementById('forgotPasswordModal');
        const loginModal = document.getElementById('loginModal');
        const signupModal = document.getElementById('signupModal');
        
        if (forgotModal) forgotModal.style.display = 'flex';
        if (loginModal) loginModal.style.display = 'none';
        if (signupModal) signupModal.style.display = 'none';
      }
      
      function closeForgotPasswordModal() {
        const forgotModal = document.getElementById('forgotPasswordModal');
        const loginModal = document.getElementById('loginModal');
        
        if (forgotModal) forgotModal.style.display = 'none';
        if (loginModal) loginModal.style.display = 'flex';
        
        // Reset modal state for next time
        document.getElementById('forgotPasswordForm').style.display = 'block';
        document.getElementById('resetSuccessMessage').style.display = 'none';
        document.getElementById('resetEmail').value = '';
      }
      
      // Handle forgot password form submission
      const forgotPasswordForm = document.getElementById('forgotPasswordForm');
      if (forgotPasswordForm) {
        forgotPasswordForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const email = document.getElementById('resetEmail').value;
        console.log('Forgot password request for email:', email);
        
        try {
          console.log('Sending password reset request for:', email);
          const response = await fetch('/api/forgot-password', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ email: email })
          });
          
          console.log('Response status:', response.status);
          console.log('Response ok:', response.ok);
          console.log('Response headers:', response.headers);
          
          const result = await response.json();
          console.log('Password reset response:', result);
          
          if (response.ok) {
            console.log('Password reset successful!');
            
            // Send actual email using EmailJS
            try {
              await sendPasswordResetEmail(email);
              // Show success message in modal
              document.getElementById('resetSuccessMessage').style.display = 'block';
              // Hide the form
              document.getElementById('forgotPasswordForm').style.display = 'none';
            } catch (emailError) {
              console.error('EmailJS error:', emailError);
              // Show success message anyway since backend processed it
              document.getElementById('resetSuccessMessage').style.display = 'block';
              document.getElementById('forgotPasswordForm').style.display = 'none';
            }
          } else {
            console.log('Password reset failed:', result.error);
            // Show error message in modal instead of alert
            document.getElementById('resetSuccessMessage').innerHTML = '<p>❌ Error: ' + result.error + '</p>';
            document.getElementById('resetSuccessMessage').style.display = 'block';
            document.getElementById('forgotPasswordForm').style.display = 'none';
          }
        } catch (error) {
          console.error('Network or parsing error:', error);
          // Show error message in modal instead of alert
          document.getElementById('resetSuccessMessage').innerHTML = '<p>❌ Failed to send reset link. Please try again.</p>';
          document.getElementById('resetSuccessMessage').style.display = 'block';
          document.getElementById('forgotPasswordForm').style.display = 'none';
        }
      });
      } else {
        console.error('Forgot password form not found');
      }
      
      // Function to send password reset email using EmailJS
      async function sendPasswordResetEmail(email) {
        // Get the reset link from the server response (we'll need to modify the backend to return it)
        // For now, we'll generate a simple reset link
        const resetLink = `${window.location.origin}/reset-password.html?email=${encodeURIComponent(email)}&token=${Date.now()}`;
        
        const templateParams = {
          to_email: email,
          to_name: email.split('@')[0], // Use email prefix as name
          from_name: 'Internship Application Manager',
          subject: 'Password Reset Request',
          message: `You requested a password reset for your Internship Application Manager account.

Click the link below to reset your password:
${resetLink}

This link will expire in 1 hour.

If you didn't request this reset, please ignore this email.

Best regards,
Internship Application Manager Team`,
          reset_link: resetLink
        };

        // EmailJS credentials (same as main app)
        const serviceId = 'service_lk4nt0v';
        const templateId = 'template_a3kh9cp';
        const publicKey = 'X80istNGO-VJ1Q9zZ';

        console.log('Sending password reset email via EmailJS...');
        const response = await emailjs.send(serviceId, templateId, templateParams, publicKey);
        console.log('EmailJS response:', response);
        return response;
      }
    </script>
  </body>
</html>
